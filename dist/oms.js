!function(){"use strict";var t={}.hasOwnProperty,e=[].slice;(function(){if(null!=this.L)return this.OverlappingMarkerSpiderfier=function(){var r,i;function n(e,r){var i,n,s,a,h,l;for(s in this.map=e,null==r&&(r={}),r)t.call(r,s)&&(l=r[s],this[s]=l);for(this.initMarkerArrays(),this.listeners={},n=0,a=(h=["click","zoomend"]).length;n<a;n++)i=h[n],this.map.addEventListener(i,function(t){return function(){return t.unspiderfy()}}(this))}return(r=n.prototype).VERSION="0.2.6",i=2*Math.PI,r.keepSpiderfied=!1,r.nearbyDistance=20,r.circleSpiralSwitchover=9,r.circleFootSeparation=25,r.circleStartAngle=i/12,r.spiralFootSeparation=28,r.spiralLengthStart=11,r.spiralLengthFactor=5,r.legWeight=1.5,r.legColors={usual:"#222",highlighted:"#f00"},r.initMarkerArrays=function(){return this.markers=[],this.markerListeners=[]},r.addMarker=function(t){var e,r;return null!=t._oms?this:(t._oms=!0,r=this,e=function(){return r.spiderListener(t)},t.addEventListener("click",e),this.markerListeners.push(e),this.markers.push(t),this)},r.getMarkers=function(){return this.markers.slice(0)},r.removeMarker=function(t){var e,r;return null!=t._omsData&&this.unspiderfy(),(e=this.arrIndexOf(this.markers,t))<0?this:(r=this.markerListeners.splice(e,1)[0],t.removeEventListener("click",r),delete t._oms,this.markers.splice(e,1),this)},r.clearMarkers=function(){var t,e,r,i,n,s;for(this.unspiderfy(),t=e=0,r=(s=this.markers).length;e<r;t=++e)i=s[t],n=this.markerListeners[t],i.removeEventListener("click",n),delete i._oms;return this.initMarkerArrays(),this},r.addListener=function(t,e){var r;return(null!=(r=this.listeners)[t]?r[t]:r[t]=[]).push(e),this},r.removeListener=function(t,e){var r;return(r=this.arrIndexOf(this.listeners[t],e))<0||this.listeners[t].splice(r,1),this},r.clearListeners=function(t){return this.listeners[t]=[],this},r.trigger=function(){var t,r,i,n,s,a,h,l;for(r=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],l=[],n=0,s=(h=null!=(a=this.listeners[r])?a:[]).length;n<s;n++)i=h[n],l.push(i.apply(null,t));return l},r.generatePtsCircle=function(t,e){var r,n,s,a,h,l,o;for(h=this.circleFootSeparation*(2+t)/i,n=i/t,o=[],s=a=0,l=t;0<=l?a<l:a>l;s=0<=l?++a:--a)r=this.circleStartAngle+s*n,o.push(new L.Point(e.x+h*Math.cos(r),e.y+h*Math.sin(r)));return o},r.generatePtsSpiral=function(t,e){var r,n,s,a,h,l,o;for(a=this.spiralLengthStart,r=0,o=[],n=s=0,l=t;0<=l?s<l:s>l;n=0<=l?++s:--s)r+=this.spiralFootSeparation/a+5e-4*n,h=new L.Point(e.x+a*Math.cos(r),e.y+a*Math.sin(r)),a+=i*this.spiralLengthFactor/r,o.push(h);return o},r.spiderListener=function(t){var e,r,i,n,s,a,h,l,o,u;if((a=null!=t._omsData)&&this.keepSpiderfied||this.unspiderfy(),a)return this.trigger("click",t);for(h=[],l=[],o=this.nearbyDistance*this.nearbyDistance,s=this.map.latLngToLayerPoint(t.getLatLng()),e=0,r=(u=this.markers).length;e<r;e++)i=u[e],this.map.hasLayer(i)&&(n=this.map.latLngToLayerPoint(i.getLatLng()),this.ptDistanceSq(n,s)<o?h.push({marker:i,markerPt:n}):l.push(i));return 1===h.length?this.trigger("click",t):this.spiderfy(h,l)},r.makeHighlightListeners=function(t){return{highlight:(e=this,function(){return t._omsData.leg.setStyle({color:e.legColors.highlighted})}),unhighlight:function(e){return function(){return t._omsData.leg.setStyle({color:e.legColors.usual})}}(this)};var e},r.spiderfy=function(t,e){var r,i,n,s,a,h,l,o,u,g,c;return this.spiderfying=!0,g=t.length,r=this.ptAverage(function(){var e,r,i;for(i=[],e=0,r=t.length;e<r;e++)l=t[e],i.push(l.markerPt);return i}()),s=g>=this.circleSpiralSwitchover?this.generatePtsSpiral(g,r).reverse():this.generatePtsCircle(g,r),c=function(){var e,r,l;for(l=[],e=0,r=s.length;e<r;e++)n=s[e],i=this.map.layerPointToLatLng(n),u=this.minExtract(t,function(t){return function(e){return t.ptDistanceSq(e.markerPt,n)}}(this)),h=u.marker,a=new L.Polyline([h.getLatLng(),i],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.map.addLayer(a),h._omsData={usualPosition:h.getLatLng(),leg:a},this.legColors.highlighted!==this.legColors.usual&&(o=this.makeHighlightListeners(h),h._omsData.highlightListeners=o,h.addEventListener("mouseover",o.highlight),h.addEventListener("mouseout",o.unhighlight)),h.setLatLng(i),h.setZIndexOffset(1e6),l.push(h);return l}.call(this),delete this.spiderfying,this.spiderfied=!0,this.trigger("spiderfy",c,e)},r.unspiderfy=function(t){var e,r,i,n,s,a,h;if(null==t&&(t=null),null==this.spiderfied)return this;for(this.unspiderfying=!0,h=[],s=[],e=0,r=(a=this.markers).length;e<r;e++)null!=(i=a[e])._omsData?(this.map.removeLayer(i._omsData.leg),i!==t&&i.setLatLng(i._omsData.usualPosition),i.setZIndexOffset(0),null!=(n=i._omsData.highlightListeners)&&(i.removeEventListener("mouseover",n.highlight),i.removeEventListener("mouseout",n.unhighlight)),delete i._omsData,h.push(i)):s.push(i);return delete this.unspiderfying,delete this.spiderfied,this.trigger("unspiderfy",h,s),this},r.ptDistanceSq=function(t,e){var r,i;return(r=t.x-e.x)*r+(i=t.y-e.y)*i},r.ptAverage=function(t){var e,r,i,n,s,a;for(s=a=0,e=0,r=t.length;e<r;e++)s+=(n=t[e]).x,a+=n.y;return i=t.length,new L.Point(s/i,a/i)},r.minExtract=function(t,e){var r,i,n,s,a,h;for(n=s=0,a=t.length;s<a;n=++s)h=e(t[n]),(void 0===r||null===r||h<i)&&(i=h,r=n);return t.splice(r,1)[0]},r.arrIndexOf=function(t,e){var r,i,n;if(null!=t.indexOf)return t.indexOf(e);for(r=i=0,n=t.length;i<n;r=++i)if(t[r]===e)return r;return-1},n}()}).call(window)}();
